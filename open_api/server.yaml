openapi: 3.0.0

info:
  title: HGraber next
  version: 0.0.0

servers:
  - url: http://localhost:8080/

security:
  - headerAuth: []
  - cookies: []

tags:
  - name: user
    description: Взаимодействие с данными пользователя
  - name: book
    description: Взаимодействие с данными книги
  - name: parsing
    description: Взаимодействие с системами парсинга и обработки первичных данных
  - name: attribute
    description: Взаимодействие с данными атрибутов
  - name: label
    description: Взаимодействие с данными меток
  - name: agent
    description: Взаимодействие с системами агентов
  - name: rebuild
    description: Перестроение и изменение книг
  - name: deduplicate
    description: Дедупликация данных
  - name: task
    description: Взаимодействие с асинхронными задачами
  - name: system
    description: Взаимодействие с системой граббера

paths:
  /api/user/login:
    post:
      description: Проставление токена в куки
      summary: Проставление токена в куки
      tags:
        - user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: Токен пользователя
              required:
                - token
      responses:
        204:
          description: Успешная авторизация
          headers:
            Set-Cookie:
              schema:
                type: string
                description: Токен доступа
        400:
          description: Пользовательская ошибка при авторизации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/file/{id}:
    get:
      description: Получение тела файла (изображения страницы)
      summary: Получение тела файла
      tags:
        - book
      parameters:
        - name: id
          description: ID файла для получения
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Успешный ответ с данными
          content:
            image/*:
              schema:
                type: string
                format: binary
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/system/info:
    get:
      description: Получение общей информации о системе
      summary: Текущее состояние системы
      tags:
        - parsing
        - system
      responses:
        200:
          description: Информация о системе
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemInfo"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/task/create:
    post:
      description: Создание и фоновый запуск задачи
      summary: Создание и запуск задачи
      tags:
        - task
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  enum:
                    - deduplicate_files
                    - remove_detached_files
                    - remove_mismatch_files
                  description: Код задачи
              required:
                - code
      responses:
        204:
          description: Успешное создание и запуск
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/task/results:
    get:
      description: Получение результатов задач
      summary: Получение результатов задач
      tags:
        - task
      responses:
        200:
          description: Информация о результатах
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    description: Результаты
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Название задачи
                        error:
                          type: string
                          description: Данные об ошибке
                        result:
                          type: string
                          description: Данные результата
                        duration_formatted:
                          type: string
                          description: Продолжительность выполнения задачи
                        started_at:
                          type: string
                          format: date-time
                          description: Время запуска задачи
                        ended_at:
                          type: string
                          format: date-time
                          description: Время завершения задачи
                        stages:
                          type: array
                          description: Этапы выполнения задачи
                          items:
                            type: object
                            properties:
                              name:
                                type: string
                                description: Название этапа
                              error:
                                type: string
                                description: Данные об ошибке
                              result:
                                type: string
                                description: Данные результата
                              duration_formatted:
                                type: string
                                description: Продолжительность выполнения этапа
                              started_at:
                                type: string
                                format: date-time
                                description: Время запуска этапа
                              ended_at:
                                type: string
                                format: date-time
                                description: Время завершения этапа
                              progress:
                                type: number
                                format: int64
                                description: Количество выполненных шагов
                              total:
                                type: number
                                format: int64
                                description: Общеее число шагов которое нужно для завершения этапа
                            required:
                              - name
                              - duration_formatted
                              - started_at
                              - ended_at
                              - progress
                              - total
                      required:
                        - name
                        - duration_formatted
                        - started_at
                        - ended_at
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/attribute/count:
    get:
      description: Получение информации о количестве вариантов атрибутов
      summary: Количество вариантов атрибутов
      tags:
        - attribute
      responses:
        200:
          description: Информация об атрибутах
          content:
            application/json:
              schema:
                type: object
                properties:
                  attributes:
                    description: Список аттрибутов
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: string
                          description: Код аттрибута
                        value:
                          type: string
                          description: Значение аттрибута
                        count:
                          type: integer
                          description: Количество книг с таким аттрибутом
                      required:
                        - code
                        - value
                        - count
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/set:
    post:
      description: Установка метки на книгу или страницу
      summary: Установка метки
      tags:
        - label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_id:
                  type: string
                  format: uuid
                  description: ID книги
                page_number:
                  type: integer
                  description: Номер страницы, если нет метка ставится на всю книгу
                name:
                  type: string
                  description: Название метки (ее код)
                value:
                  type: string
                  description: Значение метки
              required:
                - book_id
                - name
                - value
      responses:
        204:
          description: Успешное установка
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/delete:
    post:
      description: Удаление метки на книгу или страницу
      summary: Удаление метки
      tags:
        - label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_id:
                  type: string
                  format: uuid
                  description: ID книги
                page_number:
                  type: integer
                  description: Номер страницы, если нет метка удаляется у книги
                name:
                  type: string
                  description: Название метки (ее код)
              required:
                - book_id
                - name
      responses:
        204:
          description: Успешное удаление
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/get:
    post:
      description: Получение меток книги
      summary: Получение меток книги
      tags:
        - label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_id:
                  type: string
                  format: uuid
                  description: ID книги
              required:
                - book_id
      responses:
        200:
          description: Информация о метке
          content:
            application/json:
              schema:
                type: object
                properties:
                  labels:
                    type: array
                    description: Метки книги
                    items:
                      type: object
                      properties:
                        book_id:
                          type: string
                          format: uuid
                          description: ID книги
                        page_number:
                          type: integer
                          description: Номер страницы, если нет метка на всю книгу
                        name:
                          type: string
                          description: Название метки (ее код)
                        value:
                          type: string
                          description: Значение метки
                        created_at:
                          type: string
                          format: date-time
                          description: Время создания метки в системе
                      required:
                        - book_id
                        - page_number
                        - name
                        - value
                        - created_at
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/preset/create:
    post:
      description: Создание пресета меток
      summary: Создание пресета меток
      tags:
        - label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Название метки (ее код)
                description:
                  type: string
                  description: Описание метки
                values:
                  type: array
                  description: Значения метки
                  items:
                    type: string
              required:
                - name
                - values
      responses:
        204:
          description: Успешное создание пересета
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/preset/update:
    post:
      description: Обновления пресета меток
      summary: Обновления пресета меток
      tags:
        - label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Название метки (ее код)
                description:
                  type: string
                  description: Описание метки
                values:
                  type: array
                  description: Значения метки
                  items:
                    type: string
              required:
                - name
                - values
      responses:
        204:
          description: Успешное создание пересета
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/preset/delete:
    post:
      description: Удаление пресета меток
      summary: Удаление пресета меток
      tags:
        - label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Название метки (ее код)
              required:
                - name
      responses:
        204:
          description: Успешное создание пересета
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/preset/get:
    post:
      description: Пресеты меток
      summary: Пресеты меток
      tags:
        - label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Название метки (ее код)
              required:
                - name
      responses:
        200:
          description: Информация о метке
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    description: Название метки (ее код)
                  description:
                    type: string
                    description: Описание метки
                  values:
                    type: array
                    description: Значения метки
                    items:
                      type: string
                  created_at:
                    type: string
                    format: date-time
                    description: Время создания в системе
                  updated_at:
                    type: string
                    format: date-time
                    description: Время обновления в системе
                required:
                  - name
                  - values
                  - created_at
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/label/preset/list:
    get:
      description: Пресеты меток
      summary: Пресеты меток
      tags:
        - label
      responses:
        200:
          description: Информация о метках
          content:
            application/json:
              schema:
                type: object
                properties:
                  presets:
                    description: Список пресетов
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Название метки (ее код)
                        description:
                          type: string
                          description: Описание метки
                        values:
                          type: array
                          description: Значения метки
                          items:
                            type: string
                        created_at:
                          type: string
                          format: date-time
                          description: Время создания в системе
                        updated_at:
                          type: string
                          format: date-time
                          description: Время обновления в системе
                      required:
                        - name
                        - values
                        - created_at
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/details:
    post:
      description: Информация о книге
      summary: Информация о книге
      tags:
        - book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID книги
              required:
                - id
      responses:
        200:
          description: Информация о книге
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BookDetails"
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/raw:
    post:
      description: Информация о книге (или по ИД или по адресу)
      summary: Информация о книге
      tags:
        - book
        - rebuild
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID книги
                url:
                  type: string
                  format: uri
                  description: Оригинальный URL книги
      responses:
        200:
          description: Информация о книге
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BookRaw"
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/update:
    post:
      description: Изменяет часть данных книги, ряд полей не изменяется (верификация, число страниц и т.д.)
      summary: Изменение данных книги
      tags:
        - book
        - rebuild
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BookRaw"
      responses:
        204:
          description: Успешное изменение данных
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/rebuild:
    post:
      description: Может как создать новую книгу, так и добавить данные в другую пересобранную
      summary: Создает новую книгу из старой
      tags:
        - book
        - rebuild
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                old_book:
                  $ref: "#/components/schemas/BookRaw"
                selected_pages:
                  type: array
                  description: Список страниц из старой книги
                  items:
                    type: integer
                    minimum: 1
                merge_with_book:
                  type: string
                  format: uuid
                  description: ID книги в которую надо добавить страницы
                only_unique:
                  type: boolean
                  description: Включать только уникальные страницы
              required:
                - old_book
                - selected_pages
      responses:
        200:
          description: Успешное создание или обновление данных
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    description: ID книги в которую были добавлены страницы
                required:
                  - id
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/list:
    post:
      description: Список книг
      summary: Список книг
      tags:
        - book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BookFilter"
      responses:
        200:
          description: Данные книг
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    description: Список книг
                    items:
                      $ref: "#/components/schemas/BookShortInfo"
                  count:
                    type: integer
                    description: Общее количество книг по фильтру
                  pages:
                    type: array
                    description: Форматированный список страниц
                    items:
                      type: object
                      properties:
                        value:
                          type: integer
                          description: Номер страницы
                        is_current:
                          type: boolean
                          description: Это активная страница (по факту запрошенная)
                        is_separator:
                          type: boolean
                          description: Это разделитель страниц
                      required:
                        - value
                        - is_current
                        - is_separator
                required:
                  - count
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/archive/{id}:
    get:
      description: Получение архива с книгой
      summary: Получение архива с книгой
      tags:
        - book
      parameters:
        - name: id
          description: ID книги для получения
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          description: Успешный ответ с данными
          headers:
            Content-Disposition:
              schema:
                type: string
          content:
            application/*:
              schema:
                type: string
                format: binary
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/page/body:
    post:
      description: Получение тела страницы (по оригинальному адресу или данным книги)
      summary: Получение тела страницы
      tags:
        - book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID книги
                page_number:
                  type: integer
                  description: Номер страницы
                url:
                  type: string
                  format: uri
                  description: Оригинальный URL страницы
      responses:
        200:
          description: Успешный ответ с данными
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/delete:
    post:
      description: Удаление книги (без удаления метаинформации)
      summary: Удаление книги
      tags:
        - book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID книги
              required:
                - id
      responses:
        204:
          description: Успешное удаление
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/book/verify:
    post:
      description: Подтверждение (модерация) книги, нужна в случае массовой обработки
      summary: Подтверждение (модерация) книги
      tags:
        - book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID книги
              required:
                - id
      responses:
        204:
          description: Успешное подтверждение
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/system/handle:
    post:
      description: Обработка ссылок на новые книги
      summary: Обработка ссылок на новые книги
      tags:
        - parsing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                urls:
                  type: array
                  description: Ссылки на внешние системы
                  items:
                    type: string
                    format: uri
                is_multi:
                  type: boolean
                  description: Режим обработки мульти ссылок (на тома книг)
                auto_verify:
                  type: boolean
                  description: Пометить книги подтвержденными
              required:
                - urls
      responses:
        200:
          description: Итог обработки
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_count:
                    type: integer
                    description: Общее количество обработанных
                  loaded_count:
                    type: integer
                    description: Количество загруженных (успешно обработанных)
                  duplicate_count:
                    type: integer
                    description: Количество дубликатов (пропущенных)
                  error_count:
                    type: integer
                    description: Количество неудачных обработок
                  not_handled:
                    type: array
                    description: Не обработанные ссылки
                    items:
                      type: string
                      format: uri
                  details:
                    type: array
                    description: Подробности результата обработки
                    items:
                      type: object
                      properties:
                        url:
                          type: string
                          format: uri
                          description: Изначальная ссылка
                        is_duplicate:
                          type: boolean
                          description: Эта дубликат другой книги
                        duplicate_id:
                          type: string
                          format: uuid
                          description: ID книги в системе которую дублирует текущая
                        is_handled:
                          type: boolean
                          description: Книга успешно обработана и добавлена в систему
                        error_reason:
                          type: string
                          description: Описание ошибки которое произошло во время обработки
                      required:
                        - url
                        - is_duplicate
                        - is_handled
                required:
                  - total_count
                  - loaded_count
                  - duplicate_count
                  - error_count
                  - details
        400:
          description: Некорректный запрос данных
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/parsing/book/exists:
    post:
      description: Проверка наличия ссылок на книги
      summary: Проверка наличия ссылок на книги
      tags:
        - parsing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                urls:
                  type: array
                  description: Ссылки на внешние системы
                  items:
                    type: string
                    format: uri
              required:
                - urls
      responses:
        200:
          description: Успешная проверка
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    description: Результат обработки
                    items:
                      type: object
                      properties:
                        url:
                          type: string
                          format: uri
                          description: Ссылка на внешнюю систему
                        result:
                          type: string
                          description: Результат проверки
                          enum:
                            - ok
                            - unsupported
                            - error
                        error_details:
                          type: string
                          description: Данные об ошибке во время обработки
                        possible_duplicates:
                          type: array
                          description: Список возможных ссылок дубликатов (зеркала внешних систем и т.п.)
                          items:
                            type: string
                            format: uri
                      required:
                        - url
                        - result
                required:
                  - result
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Токен доступа не предоставлен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/parsing/page/exists:
    post:
      description: Проверка наличия ссылок для страниц
      summary: Проверка наличия ссылок для страниц
      tags:
        - parsing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                urls:
                  type: array
                  description: Ссылки на внешние системы
                  items:
                    type: object
                    properties:
                      book_url:
                        type: string
                        format: uri
                        description: Ссылка на книгу во внешней системе
                      image_url:
                        type: string
                        format: uri
                        description: Ссылка на изображение во внешней системе
                    required:
                      - book_url
                      - image_url
              required:
                - urls
      responses:
        200:
          description: Успешная проверка
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    description: Результат обработки
                    items:
                      type: object
                      properties:
                        book_url:
                          type: string
                          format: uri
                          description: Ссылка на книгу во внешней системе
                        image_url:
                          type: string
                          format: uri
                          description: Ссылка на изображение во внешней системе
                        result:
                          type: string
                          description: Результат проверки
                          enum:
                            - ok
                            - unsupported
                            - error
                        error_details:
                          type: string
                          description: Данные об ошибке во время обработки
                      required:
                        - book_url
                        - image_url
                        - result
                required:
                  - result
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Токен доступа не предоставлен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/system/import/archive:
    post:
      description: Импорт новой книги через архив
      summary: Импорт новой книги
      requestBody:
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
        required: true
      tags:
        - system
      responses:
        200:
          description: Успешный импорт
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    description: ID новой книги
                required:
                  - id
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/system/deduplicate/archive:
    post:
      description: Проверка наличия данных в системе из архива
      summary: Проверка наличия данных в системе из архива
      tags:
        - system
        - deduplicate
      requestBody:
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
        required: true
      responses:
        200:
          description: Успешное получение результата
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    book_id:
                      type: string
                      format: uuid
                      description: ID книги
                    book_origin_url:
                      type: string
                      format: uri
                      description: Оригинальный адрес книги
                    entry_percentage:
                      type: number
                      format: float64
                      description: Процент (0-1) вхождения архива в книгу
                    reverse_entry_percentage:
                      type: number
                      format: float64
                      description: Процент (0-1) вхождения книги в архив
                  required:
                    - book_id
                    - entry_percentage
                    - reverse_entry_percentage
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/deduplicate/book-by-page-body:
    post:
      description: Поиск дубликатов книги по телу страницы
      summary: Поиск дубликатов книги по телу страницы
      tags:
        - deduplicate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_id:
                  type: string
                  format: uuid
                  description: ID исходной книги
              required:
                - book_id
      responses:
        200:
          description: Успешное получение результата
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      type: object
                      properties:
                        book:
                          $ref: "#/components/schemas/BookSimple"
                        origin_covered_target:
                          type: number
                          format: float64
                          description: Процент (0-1) покрытия оригинала в книге
                        target_covered_origin:
                          type: number
                          format: float64
                          description: Процент (0-1) покрытия книги в оригинале
                      required:
                        - book
                        - origin_covered_target
                        - target_covered_origin
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/deduplicate/unique-pages:
    post:
      description: Поиск уникальных страниц в книге
      summary: Поиск уникальных страниц в книге
      tags:
        - deduplicate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_id:
                  type: string
                  format: uuid
                  description: ID исходной книги
              required:
                - book_id
      responses:
        200:
          description: Успешное получение результата
          content:
            application/json:
              schema:
                type: object
                properties:
                  pages:
                    type: array
                    items:
                      $ref: "#/components/schemas/PageSimple"
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/deduplicate/books-by-page:
    post:
      description: Поиск книг содержащих такую же страницу (тело)
      summary: Поиск книг содержащих такую же страницу (тело)
      tags:
        - deduplicate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_id:
                  type: string
                  format: uuid
                  description: ID исходной книги
                page_number:
                  type: integer
                  minimum: 1
                  description: Номер страницы в исходной книге
              required:
                - book_id
                - page_number
      responses:
        200:
          description: Успешное получение результата
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: "#/components/schemas/BookSimple"
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/deduplicate/compare:
    post:
      description: Сравнение двух книг на дублируемые страницы
      summary: Сравнение двух книг на дублируемые страницы
      tags:
        - deduplicate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                origin_book_id:
                  type: string
                  format: uuid
                  description: ID исходной книги
                target_book_id:
                  type: string
                  format: uuid
                  description: ID целевой книги
              required:
                - origin_book_id
                - target_book_id
      responses:
        200:
          description: Успешное получение результата
          content:
            application/json:
              schema:
                type: object
                properties:
                  origin:
                    description: ID исходной книги
                    $ref: "#/components/schemas/BookSimple"
                  target:
                    description: ID целевой книги
                    $ref: "#/components/schemas/BookSimple"
                  origin_pages:
                    type: array
                    description: Страницы что есть только в оригинальной книге
                    items:
                      $ref: "#/components/schemas/PageSimple"
                  both_pages:
                    type: array
                    description: Страницы что есть в обоих книгах
                    items:
                      $ref: "#/components/schemas/PageSimple"
                  target_pages:
                    type: array
                    description: Страницы что есть только в целевой книге
                    items:
                      $ref: "#/components/schemas/PageSimple"
                required:
                  - origin
                  - target
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/agent/task/export:
    post:
      description: Экспорт книг в другую систему
      summary: Экспорт книг в другую систему
      tags:
        - agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_filter:
                  $ref: "#/components/schemas/BookFilter"
                exporter:
                  type: string
                  format: uuid
                  description: ID агента
                delete_after:
                  type: boolean
                  description: Удалять ли файлы после экспорта
              required:
                - book_filter
                - exporter
      responses:
        204:
          description: Успешное создание задачи экспорта
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/agent/new:
    post:
      description: Создание нового агента
      summary: Создание нового агента
      tags:
        - agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Название агента
                addr:
                  type: string
                  description: Адрес агента
                  format: uri
                  example: http://example.com
                token:
                  type: string
                  description: Токен доступа к агенту
                can_parse:
                  type: boolean
                  description: Может ли агент обрабатывать ссылки внешних систем
                can_parse_multi:
                  type: boolean
                  description: Может ли агент обрабатывать множественные ссылки внешних систем
                can_export:
                  type: boolean
                  description: Может ли агент экспортировать данные из системы
                priority:
                  type: integer
                  description: Приоритет при выборе агентов
              required:
                - name
                - addr
                - token
      responses:
        204:
          description: Успешное создание агента
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/agent/list:
    post:
      description: Список агентов
      summary: Список агентов
      tags:
        - agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                can_parse:
                  type: boolean
                  description: Может ли агент обрабатывать ссылки внешних систем
                can_export:
                  type: boolean
                  description: Может ли агент экспортировать данные из системы
                can_parse_multi:
                  type: boolean
                  description: Может ли агент обрабатывать множественные ссылки внешних систем
                include_status:
                  type: boolean
                  description: Проверить состояние агента (запрос статуса у самого агента)
      responses:
        200:
          description: Успешное получение информации
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    status:
                      type: object
                      description: Статус агента
                      properties:
                        start_at:
                          type: string
                          format: date-time
                          description: Время запуска агента
                        check_status_error:
                          type: string
                          description: Ошибка которая возникла при получении статуса
                        status:
                          type: string
                          description: Текущее состояние агента
                          enum:
                            - ok
                            - warning
                            - error
                            - offline
                            - unknown
                        problems:
                          type: array
                          description: Список проблем
                          items:
                            type: object
                            properties:
                              type:
                                type: string
                                description: Тип проблемы
                                enum:
                                  - info
                                  - warning
                                  - error
                              details:
                                type: string
                                description: Описание проблемы
                            required:
                              - type
                              - details
                      required:
                        - status
                    id:
                      type: string
                      format: uuid
                      description: ID агента
                    name:
                      type: string
                      description: Название агента
                    addr:
                      type: string
                      description: Адрес агента
                      format: uri
                      example: http://example.com
                    can_parse:
                      type: boolean
                      description: Может ли агент обрабатывать ссылки внешних систем
                    can_parse_multi:
                      type: boolean
                      description: Может ли агент обрабатывать множественные ссылки внешних систем
                    can_export:
                      type: boolean
                      description: Может ли агент экспортировать данные из системы
                    priority:
                      type: integer
                      description: Приоритет при выборе агентов
                    create_at:
                      type: string
                      format: date-time
                      description: Время создания агента
                  required:
                    - id
                    - name
                    - addr
                    - can_parse
                    - can_parse_multi
                    - can_export
                    - priority
                    - create_at
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/agent/delete:
    post:
      description: Удаление агента
      summary: Удаление агента
      tags:
        - agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID агента
              required:
                - id
      responses:
        204:
          description: Успешное удаление агента
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        404:
          description: Данные не существуют
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/system/worker/config:
    post:
      description: Динамическая конфигурация раннеров (воркеров), сбрасывается при перезапуске системы
      summary: Динамическая конфигурация раннеров (воркеров)
      tags:
        - system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                runners_count:
                  type: array
                  description: Количество раннеров
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        description: Название (код) раннера
                      count:
                        type: integer
                        description: Новое количество раннеров
                    required:
                      - name
                      - count
      responses:
        204:
          description: Успешное изменение конфигурации
        400:
          description: Некорректный запрос
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        401:
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        403:
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        500:
          description: Серверная ошибка
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    SystemInfo:
      type: object
      description: Информация о системе
      properties:
        count:
          type: integer
          description: Количество книг
        downloaded_count:
          type: integer
          description: Количество загруженных книг
        verified_count:
          type: integer
          description: Количество верифицированных книг
        not_load_count:
          type: integer
          description: Количество не обработанных книг
        page_count:
          type: integer
          description: Количество страниц
        not_load_page_count:
          type: integer
          description: Количество не загруженных страниц
        page_without_body_count:
          type: integer
          description: Количество страниц без тела (файла)
        pages_size:
          type: integer
          format: int64
          description: Объем загруженных изображений в байтах
        pages_size_formatted:
          type: string
          description: Объем загруженных изображений в человеко-читаемом формате
        files_size:
          type: integer
          format: int64
          description: Объем файлов в байтах
        files_size_formatted:
          type: string
          description: Объем файлов в человеко-читаемом формате
        monitor:
          type: object
          description: Данные системы мониторинга
          properties:
            workers:
              type: array
              description: Данные об обработчиках
              items:
                type: object
                properties:
                  name:
                    type: string
                    description: Название обработчика
                  in_queue:
                    type: integer
                    description: В очереди на обработку
                  in_work:
                    type: integer
                    description: В обработке
                  runners:
                    type: integer
                    description: Количество экземпляров обработчика (потоков)
                required:
                  - name
                  - in_queue
                  - in_work
                  - runners
      required:
        - count
        - downloaded_count
        - verified_count
        - not_load_count
        - page_count
        - not_load_page_count
        - pages_size
        - pages_size_formatted
        - page_without_body_count
        - files_size
        - files_size_formatted

    BookShortInfo:
      type: object
      description: Данные книги в упрощенном формате
      properties:
        id:
          type: string
          format: uuid
          description: ID книги
        created:
          type: string
          format: date-time
          description: Время создания книги в системе
        preview_url:
          type: string
          format: uri
          description: Ссылка для предпросмотра изображения книги
        parsed_name:
          type: boolean
          description: Было ли обработано название книги
        name:
          type: string
          description: Название книги
        parsed_page:
          type: boolean
          description: Были ли обработаны страницы
        page_count:
          type: integer
          description: Количество страниц
        page_loaded_percent:
          type: number
          description: Процент загруженных страниц
          maximum: 100
          minimum: 0
        tags:
          type: array
          description: Список тегов (одноименный атрибут) книги
          items:
            type: string
        has_more_tags:
          type: boolean
          description: Есть теги которые не были включены в список
      required:
        - id
        - created
        - parsed_name
        - name
        - parsed_page
        - page_count
        - page_loaded_percent
        - has_more_tags

    BookSimple:
      type: object
      description: Крайне упрощенная модель книги
      properties:
        id:
          type: string
          format: uuid
          description: ID книги
        create_at:
          type: string
          format: date-time
          description: Время создания книги в системе
        origin_url:
          type: string
          format: uri
          description: Оригинальная ссылка на книгу (во внешней системе)
        name:
          type: string
          description: Название книги
        page_count:
          type: integer
          description: Количество страниц
        preview_url:
          type: string
          format: uri
          description: Ссылка для предпросмотра изображения книги
      required:
        - id
        - create_at
        - name
        - page_count

    PageSimple:
      type: object
      properties:
        page_number:
          type: integer
          description: Номер страницы в книге
          minimum: 1
        preview_url:
          type: string
          format: uri
          description: Ссылка на изображение для предпросмотра
      required:
        - page_number

    BookDetails:
      type: object
      description: Данные книги
      properties:
        id:
          type: string
          format: uuid
          description: ID книги
        created:
          type: string
          format: date-time
          description: Время создания книги в системе
        preview_url:
          type: string
          format: uri
          description: Ссылка для предпросмотра изображения книги
        flags:
          type: object
          properties:
            parsed_name:
              type: boolean
              description: Было ли обработано название книги
            parsed_page:
              type: boolean
              description: Были ли обработаны страницы
            is_verified:
              type: boolean
              description: Была ли подтверждена книга
            is_deleted:
              type: boolean
              description: Была ли удалена книга
          required:
            - parsed_name
            - parsed_page
            - is_verified
            - is_deleted
        name:
          type: string
          description: Название книги
        page_count:
          type: integer
          description: Количество страниц
        page_loaded_percent:
          type: number
          description: Процент загруженных страниц
          maximum: 100
          minimum: 0
        attributes:
          type: array
          description: Данные атрибутов книги
          items:
            type: object
            properties:
              name:
                type: string
                description: название атрибута
              values:
                type: array
                description: значения атрибута
                items:
                  type: string
            required:
              - name
              - values
        pages:
          type: array
          description: данные страниц книги
          items:
            $ref: "#/components/schemas/PageSimple"
        size:
          type: object
          description: Данные о размере книги
          properties:
            unique:
              type: integer
              format: int64
              description: Размер уникальных файлов книги
            shared:
              type: integer
              format: int64
              description: Размер файлов в книге что пересекаются с другими книгами
            total:
              type: integer
              format: int64
              description: Общий размер файлов книги
            unique_formatted:
              type: string
              description: Размер уникальных файлов книги в человекочитаемом виде
            shared_formatted:
              type: string
              description: Размер файлов в книге что пересекаются с другими книгами в человекочитаемом виде
            total_formatted:
              type: string
              description: Общий размер файлов книги в человекочитаемом виде
          required:
            - unique
            - shared
            - total
            - unique_formatted
            - shared_formatted
            - total_formatted
      required:
        - id
        - created
        - name
        - flags
        - page_count
        - page_loaded_percent

    BookRaw:
      type: object
      description: Данные книги
      properties:
        id:
          type: string
          format: uuid
          description: ID книги
        create_at:
          type: string
          format: date-time
          description: Время создания книги в системе
        origin_url:
          type: string
          format: uri
          description: Оригинальная ссылка на книгу
        name:
          type: string
          description: Название книги
        page_count:
          type: integer
          description: Количество страниц
        attributes:
          type: array
          description: Данные атрибутов книги
          items:
            type: object
            properties:
              code:
                type: string
                description: Код атрибута
              values:
                type: array
                description: Значения атрибута
                items:
                  type: string
            required:
              - code
              - values
        pages:
          type: array
          description: данные страниц книги
          items:
            type: object
            properties:
              page_number:
                type: integer
                description: Номер страницы в книге
                minimum: 1
              origin_url:
                type: string
                format: uri
                description: Ссылка на оригинальное изображение
              ext:
                type: string
                description: Расширение файла
              create_at:
                type: string
                format: date-time
                description: Время создания страницы в системе
              downloaded:
                type: boolean
                description: Загружено ли тело страницы
              load_at:
                type: string
                format: date-time
                description: Время загрузки тела страницы
            required:
              - page_number
              - ext
              - create_at
              - downloaded
        labels:
          type: array
          description: Данные атрибутов книги
          items:
            type: object
            description: Метка в системе
            properties:
              page_number:
                type: integer
                description: Номер страницы к которой привязана метка (0 если привязана к книге)
              name:
                type: string
                description: Код атрибута
              value:
                type: string
                description: Значение
              create_at:
                type: string
                format: date-time
                description: Время создания отметки в системе
            required:
              - page_number
              - name
              - value
              - create_at
      required:
        - id
        - create_at
        - name
        - page_count

    BookFilter:
      type: object
      properties:
        sort_desc:
          type: boolean
          description: Сортировать в обратном порядке
        sort_field:
          type: string
          description: Поле для сортировки
          enum:
            - created_at
            - name
            - id
            - page_count
        count:
          type: integer
          description: Количество книг на странице
        page:
          type: integer
          description: Номер страницы
          minimum: 1
        from:
          type: string
          format: date-time
          description: Время создание книги от
        to:
          type: string
          format: date-time
          description: Время создание книги до
        verify_status:
          type: string
          description: Статус подтверждения книги
          enum:
            - all
            - only
            - except
        delete_status:
          type: string
          description: Статус удаления книги
          enum:
            - all
            - only
            - except
        download_status:
          type: string
          description: Статус загрузки книги
          enum:
            - all
            - only
            - except
        filter:
          type: object
          description: Фильтр по полям
          properties:
            name:
              type: string
              description: Фильтр по названию, без учета регистра
            attributes:
              type: array
              description: Фильтр по атрибутам
              items:
                type: object
                properties:
                  code:
                    type: string
                    description: Код атрибута
                  type:
                    type: string
                    description: Тип фильтра
                    enum:
                      - like
                      - in
                      - count_eq
                      - count_gt
                      - count_lt
                  values:
                    type: array
                    description: Значения для фильтрации (для операции like берется только 1-е значение)
                    items:
                      type: string
                  count:
                    type: integer
                    description: Количество значений атрибута у книги
                required:
                  - code
                  - type
            labels:
              type: array
              description: Фильтр по меткам (без разделения на метки страниц и книг)
              items:
                type: object
                properties:
                  name:
                    type: string
                    description: Название метки
                  type:
                    type: string
                    description: Тип фильтра
                    enum:
                      - like
                      - in
                      - count_eq
                      - count_gt
                      - count_lt
                  values:
                    type: array
                    description: Значения для фильтрации (для операции like берется только 1-е значение)
                    items:
                      type: string
                  count:
                    type: integer
                    description: Количество значений метки у книги
                required:
                  - name
                  - type

    ErrorResponse:
      type: object
      description: Данные ошибки
      properties:
        inner_code:
          type: string
          description: Внутренний код ошибки
        details:
          type: string
          description: Детальные данные ошибки
      required:
        - inner_code

  securitySchemes:
    headerAuth:
      name: X-HG-Token
      in: header
      type: apiKey
      description: Авторизация через заголовок
    cookies:
      name: X-HG-Token
      in: cookie
      type: apiKey
      description: Авторизация через печеньки
